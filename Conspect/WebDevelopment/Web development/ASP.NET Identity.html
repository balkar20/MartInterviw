<html>
<head>
  <title>Evernote Export</title>
  <basefont face="Arial" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308555 (ru-RU, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: Arial;
      font-size: 11pt;
    }
  </style>
</head>
<body>
<a name="632"/>

<div>
<span><div><div style="text-align: center;"><span style="font-size: 16pt;">ASP.NET Identity</span></div><hr/><div style="text-align: left;"><br/></div><div style="text-align: left;"><span style="font-weight: bold;">ASP.NET Identity</span> — система авторизации и аутентификации в .NET приложениях, появившаяся в MVC5. Если при создании веб-приложения выбрать тип аутентификации <span style="font-style: italic;">Individual User Accounts</span>, то в проект по умолчанию будет включена система ASP.NET Identity, которая позволяет авторизовать как пользователей внутри приложения, так и с помощью внешних сервисов, как google, твиттер и т.д. </div><div style="text-align: left;">ASP.NET Identity уже по умолчанию имеет всю необходимую для авторизации инфраструктуру: модели, контроллеры, представления, а также ряд библиотек OWIN и 3 библиотеки Microsoft.AspNet.Identity. </div><div style="text-align: left;"><br/></div><div style="text-align: left;">Таблицы:</div><ul><li><div style="text-align: left;">AspNet<span style="font-weight: bold;">Users</span></div></li><li><div style="text-align: left;">AspNet<span style="font-weight: bold;">Roles</span></div></li><li><div style="text-align: left;">AspNet<span style="font-weight: bold;">UserRoles</span></div></li><li><div style="text-align: left;">AspNet<span style="font-weight: bold;">UserLogins</span></div></li><li><div style="text-align: left;">AspNet<span style="font-weight: bold;">UserClaims</span> — хранит набор клеймов. Claim — некоторая информация о пользователе, например, возраст, которая позволяет наделить пользователя соответствующими правами доступа. Представляет иную модель авторизации по сравнению с ролями. </div></li></ul><div style="text-align: left;"><br/></div><div style="text-align: left;">Классы:</div><ul><li><div style="text-align: left;">UserManager — создание, удаление, управление пользователями</div></li><li><div style="text-align: left;">RoleManager — управление ролями</div></li><li><div style="text-align: left;">IdentityUser → IUser</div></li><li><div style="text-align: left;">UserStore → IUserStore</div></li><li><div style="text-align: left;">IdentityRole → IRole</div></li><li><div style="text-align: left;">RoleStore → IRoleStore</div></li><li><div style="text-align: left;">IdentityDbContext — для взаимодействия с базой, содержит свойства Users и Roles.</div></li></ul><div style="text-align: left;"><br/></div><div style="text-align: left;">Базовая функциональность системы аутентификации и управления учетными записями расположена в двух контроллерах: <span style="font-family: Consolas;">AccountController</span> и <span style="font-family: Consolas;">ManageController</span>. В AccountController определены методы для регистрации, аутентификации, сброс пароля, вход на сайт с помощью внешних сервисов. Контроллер ManageController используется для управления учетной записью и предполагает возможности по смене пароля и управлению телефонными номерами в системе. Для обоих контроллеров уже по умолчанию генерируются все необходимые представления и специальные модели представлений.</div><div style="text-align: left;"><br/></div><div style="text-align: left;">Свойства класса <span style="font-weight: bold;">IdentityUser</span>: Id, Email, PasswordHash, UserName (ник), PhoneNumber, Roles, Logins, Claims (Коллекции ролей, логинов и клеймов данного пользователя)</div><div style="text-align: left;"><br/></div><div style="text-align: left;">Свойсва класса <span style="font-weight: bold;">IdentityRole</span>: Id, Name, Users (Коллекция пользователей)</div><div style="text-align: left;"><br/></div><div style="text-align: left;">ASP.NET Identity создает базу данных со стандартным набором таблиц. Однако бывает необходимо <span style="font-weight: bold;">переопределить систему ASP.NET Identity</span>, например, добавив новые поля или таблицы. К примеру, может быть необходимым добавить поле Age в таблицу Users и поле Decription в таблицу Roles, которых по умолчанию нет. Для этого следует унаследоваться от стандартных классов и нужным образом их переопределить. Классы-наследники: ApplicationUser, ApplicationRole, ApplicationUserManager, ApplicationRoleManager, ApplicationDbContext. Если БД уже существовала, то после изменения контекста, необходимо будет выполнить миграцию, для применения изменений к схеме самой базы данных.</div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><hr/><div style="text-align: left;"><br/></div><div style="text-align: center;"><font style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;">Основные возможности</span></font></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><span style="font-style: italic; font-weight: bold;">Вывод всех пользователей</span></div><div style="text-align: left;">IdentityDbContext.Users.ToList()</div><div style="text-align: left;"><br/></div><div style="text-align: left;"><span style="font-style: italic; font-weight: bold; background-color: rgb(255, 250, 165);-evernote-highlight:true;">Регистрация нового пользователя</span></div><div style="text-align: left;">IdentityResult = UserManager.<span style="font-weight: bold;">CreateAsync</span>(IdentityUser, password) </div><div style="text-align: left;"><br/></div><div style="text-align: left;"><span style="font-weight: bold;">Удаление пользователя</span></div><div style="text-align: left;">IdentityResult = UserManager.<span style="font-weight: bold;">DeleteAsync</span>(IdentityUser)</div><div style="text-align: left;"><br/></div><div style="text-align: left;"><span style="font-weight: bold;">Поиск пользователя по Id</span></div><div style="text-align: left;">IdentityUser = UserManager.<span style="font-weight: bold;">FindByIdAsync</span>(id)</div><div style="text-align: left;"><br/></div><div style="text-align: left;"><span style="font-weight: bold;">Поиск пользователя по Email</span></div><div style="text-align: left;">IdentityUser = UserManager.<span style="font-weight: bold;">FindByEmailAsync</span>(email)</div><div style="text-align: left;"><br/></div><div style="text-align: left;"><span style="font-weight: bold; font-style: italic;">Регистрация новой роли</span></div><div style="text-align: left;">IdentityResult = RoleManager.<span style="font-weight: bold;">CreateAsync</span>(IdentityRole)</div><div style="text-align: left;"><br/></div><div style="text-align: left;"><span style="font-weight: bold; background-color: rgb(255, 250, 165);-evernote-highlight:true;">Аутентификация пользователя на основе объектов claim</span></div><div style="text-align: left;">IdentityUser = UserManager.FindAsync(email, password)</div><div style="text-align: left;">Создание объекта ClaimsIdentity, реализующего IIdentity: UserManager.CreateIdentityAsync(IdentityUser, DefaultAuthenticationTypes.ApplicationCookie)</div><div style="text-align: left;">AuthenticationManager.<span style="font-weight: bold;">SignIn</span>(options, IIdentity) — установка аутентификационных куки. IIdentity: Name, IsAuthenticated, AuthenticationType</div><div style="text-align: left;"><br/></div><div style="text-align: left;"><span style="font-weight: bold; background-color: rgb(255, 250, 165);-evernote-highlight:true;">Разлогирование, логаут</span></div><div style="text-align: left;">AuthenticationManager.SignOut() — удаляет аутентификационные куки</div><div style="text-align: left;"><br/></div><div style="text-align: left;"><span style="font-weight: bold;">Редактирование пользователя</span></div><div style="text-align: left;">user.Year = 666;</div><div style="text-align: left;">IdentityResult = UserManager.<span style="font-weight: bold;">UpdateAsync</span>(user);</div><div style="text-align: left;"><br/></div><div style="text-align: left;"><span style="font-style: italic;">IdentityResult содержит булевское св-во Succeeded, указывающее успешно ли прошла операция. UserManager, RoleManager и AuthenticationManager получаем из контекса Owin: HttpContext.GetOwinContext().GetUserManager&lt;ApplicationRoleManager&gt;() и HttpContext.GetOwinContext().Authentication</span></div><div style="text-align: left;"><br/></div><hr/><div style="text-align: left;"><br/></div><div style="text-align: center;"><a href="https://metanit.com/sharp/mvc5/12.21.php" style="font-weight: bold; font-size: 12pt;">Авторизация на основе Claims</a></div><div style="text-align: left;"><br/></div><div style="text-align: left;">Позволяет сделать разграничение доступа, например, по возрасту. При регистрации пользователя создаем клейм, хранящий информацию о нем и добавляем этому пользователю данный клейм. После чего пишем атрибут авторизации, который будет предоставлять доступ к методам действия, на основании определенного возраста: [ClaimsAuthorize(Age = 22)] — доступ для пользователей старше 22 лет.</div><div style="text-align: left;"><br/></div><hr/><div style="text-align: left;"><br/></div><div style="text-align: left;">Owin (??), OAuth (??)</div><div style="text-align: left;"><br/></div><div style="text-align: left;"><a href="https://ru.stackoverflow.com/questions/508044/asp-net-identity-vs-%D0%A1%D0%B0%D0%BC%D0%BE%D0%BF%D0%B8%D1%81%D0%BD%D0%B0%D1%8F-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0-%D0%B0%D0%B2%D1%82%D0%BE%D1%80%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%B8">Преимущества Identity</a>:</div><ul><li><div style="text-align: left;">Авторизация на основе Claims</div></li><li><div style="text-align: left;">Интеграция OWIN</div></li><li><div style="text-align: left;">ASP.NET Identity можно использовать со всеми платформы ASP.NET</div></li><li><div style="text-align: left;">Возможности аутентификации на третьей стороне (через сторонние сервисы) — OAuth</div></li><li><div style="text-align: left;">Двухфакторная аутентификация (подтсверждение по смс или почте)</div></li><li><div style="text-align: left;">Добавление новых полей, с помощью миграций</div></li><li><div style="text-align: left;">Распространение через NuGet</div></li></ul><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><a href="https://metanit.com/sharp/mvc5/12.1.php">Авторизация и аутентификация в MVC 5 ASP.NET Identity (Metanit)</a></div><div style="text-align: left;"><a href="https://professorweb.ru/my/ASP_NET/identity/level1/1_5.php">Аутентификация с помощью ASP.NET Identity (ProfessorWeb)</a></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div></div><div><br/></div></span>
</div></body></html> 