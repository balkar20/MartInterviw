<html>
<head>
  <title>Evernote Export</title>
  <basefont face="Arial" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308555 (ru-RU, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: Arial;
      font-size: 11pt;
    }
  </style>
</head>
<body>
<a name="642"/>

<div>
<span><div><div style="text-align: center;"><span style="font-size: 16pt;">ASP.NET Core</span></div><hr/><div><br/></div><div><ul><li><div>Asp.Net Core — opensource фреймворк</div></li><li><div>Asp.Net Core позволяет создавать кроссплетформенные веб-приложения, которые могут быть развернуты на Windows, Linux, MasOs и работают поверх .Net Core. </div></li><li><div>Возможность развертывать приложения как на IIS, так и в рамках собственного процесса (с помощью встроенного кроссплатформенного веб-сервера Kestrel)</div></li><li><div>Больше нет необходимости использовать System.Web.dll</div></li><li><div>ASP.NET Core включает в себя фреймворк MVC, который объединяет функциональность MVC, Web API и Web Pages. Web Forms полностью ушли в прошлое.</div></li><li><div>Добавлены тэг-хелперы (tag helper), которые позволяют более органично соединять синтаксис html с кодом С#.</div></li><li><div>Фреймворк теперь имеет свой легковесный контейнер для внедрения зависимостей, и больше нет необходимости применять сторонние контейнеры, такие как Autofac, Ninject. </div></li><li><div>Для обработки запросов теперь используется <span style="font-weight: bold;">новый модульный конвейер HTTP</span>, который основан на компонентах Katana и спецификации OWIN.</div></li></ul></div><div><br/></div><div>Структура проекта ASP.NET Core по шаблону Empty:</div><ul><li><div>wwwroot: этот узел (на жестком диске ему соответствует одноименная папка) предназначен для хранения статических файлов - изображений, скриптов javascript, файлов css и т.д., которые используются приложением</div></li><li><div>Program.cs: главный файл приложения, с которого и начинается его выполнение. Код этого файла настраивает и запускает веб-хост, в рамках которого разворачивается приложение</div></li><li><div>Startup.cs: файл, который определяет класс Startup и который содержит логику обработки входящих запросов</div></li></ul><div><br/></div><div style="text-align: center;"><span style="font-size: 12pt; font-weight: bold;">Класс Program</span></div><div style="text-align: left;"><br/></div><div style="text-align: left;">Выполнение веб-приложения начинается с класса Program. У объекта <i><b>IWebHostBuilder</b></i> вызвывается  Build(), который создает IWebHost, а затем для запуска хоста у <i><b>IWebHost</b></i> вызывается метод Run(). В конфигурации IWebHostBuilder указывается стартовый класс, с которого будет начинаться обработка запросов UseStartup&lt;Startup&gt;()</div><div><br/></div><div style="text-align: center;"><font style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;">Класс Startup - логика по обработке запросов</span></font></div><div style="text-align: left;"></div><div style="text-align: left;">Служит для конфигурации приложения, настройки сервисов, установки компонентов для обработки запросов (middleware)</div><div><br/></div><div>Цепочка вызовов методов класса Startup: [<span style="font-weight: bold;">конструктор</span>] → [<span style="font-weight: bold;">ConfigureServices</span>(IServiceCollection services)] → <span style="font-weight: bold;">Configure</span>(IApplicationBuilder app, IHostingEnvironment env)</div><div><br/></div><div><span style="font-size: 11pt; font-family: Consolas;">// Добавляет сервисы MVC</span></div><div><span style="font-size: 11pt; font-family: Consolas;">public void ConfigureServices(IServiceCollection services)</span></div><div><span style="font-size: 11pt; font-family: Consolas;">{</span></div><div><span style="font-size: 11pt; font-family: Consolas;">    services.</span><span style="font-size: 11pt; font-family: Consolas; font-weight: bold;">Add</span><span style="font-size: 11pt; font-family: Consolas;">Mvc();</span></div><div><span style="font-size: 11pt; font-family: Consolas;">}</span></div><div><font face="Consolas" style="font-size: 11pt;"><br/></font></div><div><span style="font-size: 11pt; font-family: Consolas;">// Устанавливает, как приложение будет обрабатывать запрос</span></div><div><span style="font-size: 11pt; font-family: Consolas;">public void Configure(IApplicationBuilder app, IHostingEnvironment env)</span></div><div><span style="font-size: 11pt; font-family: Consolas;">{</span></div><div><span style="font-size: 11pt; font-family: Consolas;">    if (env.IsDevelopment())</span></div><div><span style="font-size: 11pt; font-family: Consolas;">    {</span></div><div><span style="font-size: 11pt; font-family: Consolas;">        app.</span><span style="font-size: 11pt; font-family: Consolas; font-weight: bold;">Use</span><span style="font-size: 11pt; font-family: Consolas;">DeveloperExceptionPage();</span></div><div><span style="font-size: 11pt; font-family: Consolas;">        app.</span><span style="font-size: 11pt; font-family: Consolas; font-weight: bold;">Use</span><span style="font-size: 11pt; font-family: Consolas;">BrowserLink();</span></div><div><span style="font-size: 11pt; font-family: Consolas;">    }</span></div><div><span style="font-size: 11pt; font-family: Consolas;">    else</span></div><div><span style="font-size: 11pt; font-family: Consolas;">    {</span></div><div><span style="font-size: 11pt; font-family: Consolas;">        app.</span><span style="font-size: 11pt; font-family: Consolas; font-weight: bold;">Use</span><span style="font-size: 11pt; font-family: Consolas;">ExceptionHandler(&quot;/Error&quot;);</span></div><div><span style="font-size: 11pt; font-family: Consolas;">    }</span></div><div><span style="font-size: 11pt; font-family: Consolas;">    app.</span><span style="font-size: 11pt; font-family: Consolas; font-weight: bold;">Use</span><span style="font-size: 11pt; font-family: Consolas;">StaticFiles();</span></div><div><span style="font-size: 11pt; font-family: Consolas;">    app.</span><span style="font-size: 11pt; font-family: Consolas; font-weight: bold;">Use</span><span style="font-size: 11pt; font-family: Consolas;">Mvc(routes =&gt;</span></div><div><span style="font-size: 11pt; font-family: Consolas;">    {</span></div><div><span style="font-size: 11pt; font-family: Consolas;">        routes.MapRoute(</span></div><div><span style="font-size: 11pt; font-family: Consolas;">            name: &quot;default&quot;,</span></div><div><span style="font-size: 11pt; font-family: Consolas;">            template: &quot;{controller}/{action=Index}/{id?}&quot;);</span></div><div><span style="font-size: 11pt; font-family: Consolas;">    });</span></div><div><span style="font-size: 11pt; font-family: Consolas;">}</span></div><div><br/></div><div style="text-align: center;"><font style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;">Конвейер обработки запроса</span></font></div><div><br/></div><div>Middleware — небольшие компоненты приложения, которые могут быть внедрены в конвейер обработки HTTP-запроса. Подключаются в методе Configure. </div><div>Примеры компонентов: </div><ul><li><div>app.UseExceptionHandler(&quot;/Home/Error&quot;) — установка обработчика ошибок</div></li><li><div>app.UseStaticFiles() — обработчик статических файлов, чтобы приложение могло отдавать статические файлы клиенту</div></li><li><div>app.UseMvc() — установка компонентов MVC для обработки запроса</div></li></ul><div><br/></div><div>Метод Configure запускается только один раз, и следовательно все компоненты также создаются единожды.</div><div><br/></div><div>Способы добавления компонентов:</div><ul><li><div>app.Run() — Компоненты, определенные через метод Run, не вызывают никакие другие компоненты и дальше обработку запроса не передают</div></li><li><div>app.UseXXX() — Такие компоненты передают обработку запроса дальше по конвейеру</div></li></ul><div><br/></div><hr/><div><br/></div><div>Метод Map (и методы расширения MapXXX()) применяется для сопоставления пути запроса с определeнным делегатом, который будет обрабатывать запрос по этому пути.</div><div><br/></div><div>Можно создавать свои собственные компоненты middleware и добавлять их в конвейер запроса с помощью app.<span style="font-weight: bold;">UseMiddleware</span>&lt;TokenMiddleware&gt;();</div><div><br/></div><div>Каждый компонент обрабатывает запрос дважды: до вызова await _next.Invoke(context) и после. КомпонентОбработкиОшибок(403, 404) → КомпонентАутентификации(403) → КомпонентМаршрутизации(404).</div><div><br/></div><div><br/></div><div>IHostingEnvironment env — окружение (ApplicationName, <a href="https://dotnet.today/ru/aspnet5-vnext/fundamentals/environments.html">EnvironmentName</a>: Development, Staging и Production, ContentRootPath — путь к корневой папке приложения, WebRootPath — папка, в которой хранится статический контент приложения, как правило, это папка wwwroot).</div><div><br/></div><div><br/></div><div><a href="https://metanit.com/sharp/mvc5/11.1.php">OWIN</a> — Open Web Interface for .NET — спецификация, позволяющая ослабить зависимость веб-приложений от веб-сервера. Katana — одна из реализацией OWIN. (Хост - Сервер - Компоненты Middleware - Приложение)</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 